<!--
    @license
    Copyright (c) 2015 Preston Landers <planders@utexas.edu>. All rights reserved.
    Additional portions Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
    This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
    The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
    The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
    Code distributed by Google as part of the polymer project is also
    subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../core-scaffold/core-scaffold.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<!--
<link rel="import" href="../core-menu/core-menu.html">
<link rel="import" href="../core-item/core-item.html">
-->
<link rel="import" href="../font-roboto/roboto.html">

<!-- NOTE: the presence of this plugin on the page with Firefox + Ad Block Plus plugin
     will cause the entire page to not load.-->
<link rel="import" href="../core-icons/social-icons.html">

<link rel="import" href="../firebase-element/firebase-element.html">
<link rel="import" href="../firebase-element/firebase-login.html">

<link rel="import" href="elements/speakur-toolbar.html">

<!--
This is a Web Component-based custom HTML element that provides a
user friendly discussion forum for any web resource without requiring
a dedicated server.

##### Example

    <speakur-discussion
        xtitle="12 Crazy Tricks That Cable Companies Hate!"
        theme="dark"
        moderator="example_moderator_1">
    </speakur-discussion>

##### Requirements

To embed a Speakur discussion within a web page, you must do three things:

1) Enable W3C Web Components via the Polymer script webcomponents.js

    <script src="bower_components/webcomponentsjs/webcomponents.js"></script>

2) Use HTML Imports to bring in the `<speakur-discussion>` element

    <link rel="import" href="bower_components/speakur-discussion/speakur-discussion.html">

3) Place the `<speakur-discussion>` element somewhere in the page as shown above.

TODO: link to detailed instructions on using bower_components

@element speakur-discussion
@blurb Provides an embeddable real-time discussion forum for a web resource.
@status alpha
@homepage https://github.com/Preston-Landers/speakur-discussion
-->
<polymer-element name="speakur-discussion" attributes="theme href moderators xtitle firebaseLocation">

    <template>
        <!-- Congratulations, you have found the secret message. -->

        <link rel="stylesheet" href="speakur-discussion.css"/>
        <link id="speakur-theme" rel="stylesheet" href="speakur-theme-default.css"/>

        <firebase-login id="baseLogin" user="{{user}}" statusKnown="{{statusKnown}}" location="{{firebaseLocation}}"
                        provider="google" on-login="{{onLogin}}" on-error="{{onLoginError}}"></firebase-login>

        <div class="speakur-container {{ closed ? 'closed' : '' }}">

            <template if="{{closed}}">
                <speakur-toolbar class="speakur-closed-bar">
                    <paper-icon-button icon="speaker-notes" on-click="{{toggle}}" >
                    </paper-icon-button>
                    <paper-button flex on-click="{{toggle}}" class="speakur-toggle-button">
                        View Comments ({{numComments}})
                    </paper-button>
                    <paper-icon-button id="closedprofilebutton"
                                       icon="social:person"></paper-icon-button>
                </speakur-toolbar>


            </template>
            <template if="{{!closed}}">
                <div vertical layout class="speakur-open-layout">
                    <speakur-toolbar class="speakur-header-bar">
                        <paper-icon-button
                                title="Hide"
                                icon="remove-circle"
                                on-click="{{toggle}}" class="speakur-toggle-button">
                        </paper-icon-button>
                        <div flex class="speakur-header-titlebox">
                            {{xtitle}}
                        </div>
                        <paper-icon-button id="searchbutton"
                                           icon="search"></paper-icon-button>
                        <paper-icon-button id="profilebutton"
                                           icon="social:person"></paper-icon-button>
                    </speakur-toolbar>


                    <div class="speakur-body-container">
                        <div>Body</div>
                        <div>
                            I'm open!
                        </div>
                    </div>

                    <speakur-toolbar class="speakur-footer-bar">
                        <paper-icon-button
                                id="helpbutton"
                                title="Help / About"
                                icon="help">
                        </paper-icon-button>
                        <div flex>
                            Copyright &copy; 2015 Preston Landers
                        </div>

                        <!--Questionable where we want to put this, if anywhere.-->
                        <content></content>

                        <paper-icon-button
                                id="reportbutton"
                                title="Report a problem."
                                icon="report-problem">
                        </paper-icon-button>
                    </speakur-toolbar>
                </div>

            </template>

        </div>

    </template>

    <script>

        Polymer({
            /**
             * The `xtitle` attribute determines the title of the discussion. Defaults to the containing
             * page's title.
             *
             * Note that I can't name this title due to it being a built in HTML attribute apparently...?
             *
             * @attribute xtitle
             * @type string
             * @default window.document.title
             */
            xtitle: window.document.title,

            /**
             * The `href` attribute determines the "target" of the discussion. Defaults to the containing page's location.
             *
             * @attribute href
             * @type string
             * @default window.location
             */
            href: window.location,

            /**
             * The `theme` attribute determines the style or look and feel of the discussion box.
             * Available themes are: default (TODO)
             *
             * @attribute theme
             * @type string
             * @default 'default' (a default theme)
             */
            theme: 'default',

            /**
             * The `moderators` attribute determines the users who are allowed to moderate this forum. The users are
             * represented as Firebase User IDs, comma separated.
             *
             * (TODO: non functional!)
             *
             * @attribute moderators
             * @type string
             * @default (None)
             */
            moderators: '',

            /**
             * The `firebaseLocation` attribute determines the source database URL for the comments. A default
             * database will be used if none is provided.
             *
             * @attribute firebaseLocation
             * @type string
             * @default (a suitable default is provided)
             */
            firebaseLocation: 'https://speakur.firebaseio.com',

            /**
             * numComments is the number of comments currently available at this location.
             *
             * @property numComments
             * @type int
             * @default number of comments at this location
             */
            numComments: 0,


            /**
             * This is true when the discussion widget is closed (collapsed).
             *
             * @property closed
             * @type boolean
             * @default true if the discussion is in the closed (collapsed) state
             */
            closed: true,

            ready: function () {
                // Ready is a lifecycle callback.
                // You can do setup work in here.
                // More info: http://www.polymer-project.org/docs/polymer/polymer.html#lifecyclemethods
                // this.title = 'ok?';
            },

            /**
             * The `sayHello` method will return a greeting.
             *
             * @method sayHello
             * @param {String} greeting Pass in a specific greeting.
             * @return {String} Returns a string greeting.
             */
            sayHello: function (greeting) {
                var response = greeting || 'Hello World!';
                return 'speakur-discussion says, ' + response;
            },

            /**
             * The `speakur-discussion-lasers-success` event is fired whenever we
             * call fireLasers.
             *
             * @event speakur-discussion-lasers-success
             * @param {Object} detail
             *   @param {string} detail.sound An amazing sound.
             */

            /**
             * The `fireLasers` method will fire the lasers. At least
             * it will dispatch an event that claims lasers were fired :)
             *
             * @method fireLasers
             */
            fireLasers: function () {
                this.fire('speakur-discussion-lasers-success', {sound: 'Pew pew pew!'});
            },

            toggle: function () {
                this.closed = !this.closed;
                console.log("Speakur discussion toggled.");
            }

        });

    </script>

</polymer-element>
