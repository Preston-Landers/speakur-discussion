<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../firebase-element/firebase-element.html">
<link rel="import" href="speakur-post.html">

<polymer-element 
    name="speakur-post-set"
    extends="speakur-base"
    attributes="threadId parentId level firebaseLocation posts postIds">
    <template>
        <style>
        </style>

        <firebase-element
            childEvents
            on-child-removed="{{childRemoved}}"
            id="dbPosts" location="{{postsLocation(firebaseLocation, parentId)}}"
            data="{{posts}}" keys="{{postIds}}"></firebase-element>

        <template if="{{level==0 && !postIds.length}}">
            <div>
                <h2>No one has posted yet. Be the first to comment.</h2>
            </div>
        </template>

        <template if="{{posts && postIds.length}}" repeat="{{postId in postIds}}">
            <speakur-post
                firebaseLocation="{{firebaseLocation}}"
                threadId="{{threadId}}"
                parentId="{{parentId}}"
                level="{{level}}"
                postId="{{postId}}">
            </speakur-post>
        </template>

    </template>
    <script>
        Polymer({
            level: 0,
            postsLocation: function (firebaseLocation, parentId) {
                //  {{firebaseLocation}}/posts/{{parentId}}
                if (!firebaseLocation) { return ''; }
                if (!parentId) { return ''; }
                return firebaseLocation + "/posts/" + parentId;
            },
            childRemoved: function (event) {
                this.log('child removed ', event.detail.name, ':', event.detail.value);
                // this.fire('data-changed');
            }
        });
    </script>
</polymer-element>
