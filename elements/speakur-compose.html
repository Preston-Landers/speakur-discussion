<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../paper-button/paper-button.html">
<link rel="import" href="../../firebase-element/firebase-element.html">
<link rel="import" href="../../marked-element/marked-element.html">

<link rel="import" href="speakur-post.html">

<polymer-element name="speakur-compose" attributes="firebaseLocation threadId">
    <template>
        <style>
            .cancel-btn {
                margin-right: 10px;
            }
        </style>
        <link rel="stylesheet" href="../../bootstrap/dist/css/bootstrap.min.css">
        <firebase-element
                id="posts" data="{{posts}}"
                location="{{firebaseLocation + '/posts/' + threadId }}"></firebase-element>
        <form>
            <div class="body">
                <div class="form-group">
                    <label class="sr-only" for="commentText">Leave a comment:</label>
                        <textarea
                                value="{{newText}}"
                                rows="3"
                                class="form-control"
                                placeholder="Leave a comment here."
                                id="commentText"></textarea>
                    <!--
                                        <mark-down-editor
                                                    rows="3"
                                                    class="form-control"
                                                    placeholder="Enter a comment here."
                                                    id="commentText">

                                            </mark-down-editor>
                    -->
                </div>
            </div>
            <div class="footer text-right">
                <template if="{{newText.length}}">
                    <div
                            on-click="{{cancel}}"
                            title="Cancel (Clear Text)"
                            class="btn btn-sm btn-danger cancel-btn">
                        Cancel
                    </div>
                </template>
                <div on-click="{{submit}}" title="Publish Comment" class="btn btn-sm btn-primary">Publish Comment</div>
            </div>
            <div>
                <speakur-post
                        id="preview"
                        previewText="{{newText}}"
                        previewMode="{{true}}">
                </speakur-post>
            </div>
        </form>
    </template>
    <script>
        Polymer({
            newText: '',

            submit: function () {
                if (!this.threadId) {
                    console.error("Unable to submit post; no threadId given");
                    return false;
                }
                if (this.newText.length) {

                    var post = this.$.posts.push({
                        threadId: this.threadId,
                        text: this.newText,
                        author: {
                            uid: 'anonymous',
                            username: 'Anonymous'
                        },
                        timestamp: new Date().getTime()
                    });
                    var post_id = post.key();
                    console.log("Created post: " + post_id);

                    this.newText = '';
                } else {
                    console.error('Please write something.');
                }
            },

            cancel: function () {
                if (!this.newText.length) {
                    console.error("Nothing in the compose box.");
                    return false;
                }
                this.newText = '';
            }
        });
    </script>
</polymer-element>
