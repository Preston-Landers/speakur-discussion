<!--
Copyright (c) 2015 Preston Landers. All rights reserved.
This code may only be used under the BSD style license found at http://speakur.github.io/LICENSE.txt
The complete set of authors may be found at http://speakur.github.io/AUTHORS.txt
The complete set of contributors may be found at http://speakur.github.io/CONTRIBUTORS.txt
-->
<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../pvc-globals/pvc-globals.html">
<script src="../../i18next/i18next.js"></script>

<!--
    This is a wrapper around the i18next library to provide string translation services.

    To change the language, set the locale attribute to something like 'en', 'en-US', 'fr-FR', etc.

    Based on https://github.com/Polymer/i18next-element
  -->
<polymer-element
    name="speakur-i18next"
    extends="speakur-base"
    attributes="locale">
    <template>
        <pvc-globals namespace="speakur-discussion" values="{{globals}}"></pvc-globals>
    </template>
    <script>
        (function () {

//            window.i18nResources = {};

            i18n.init({
/*
                resStore: i18nResources,
*/
                debug: true,
                fallbackLng: 'en-US',
                ns: 'speakur',
                load: 'current',
                resGetPath: 'locales/__ns__-__lng__.json'
            });

/*
            i18n.addResources = function (resStore) {
                Platform.mixin(i18nResources, resStore);
            };
*/

            var i18n_t = i18n.t;

            PolymerExpressions.prototype.$$ = i18n_t;

            Polymer({
                locale: null,

                $$: function () {
                    return i18n_t.apply(window, arguments)
                },

                localeChanged: function () {
                    var that = this;
                    i18n.setLng(this.locale, function () {
                        that.log('Language changed to:', that.locale);
                        that.globals.currentLocale = that.locale;

                        // TODO: change 'moment' library's locale?

                    });
                }

            });

        })();
    </script>
</polymer-element>
