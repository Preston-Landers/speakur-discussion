<!--
Copyright (c) 2015 Preston Landers. All rights reserved.
This code may only be used under the BSD style license found at http://speakur.github.io/LICENSE.txt
The complete set of authors may be found at http://speakur.github.io/AUTHORS.txt
The complete set of contributors may be found at http://speakur.github.io/CONTRIBUTORS.txt
-->
<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../core-menu/core-menu.html">
<link rel="import" href="../../core-icon/core-icon.html">
<link rel="import" href="../../core-item/core-item.html">
<link rel="import" href="../../paper-item/paper-item.html">
<link rel="import" href="../../paper-menu-button/paper-menu-button.html">
<link rel="import" href="../../paper-dropdown/paper-dropdown.html">
<link rel="import" href="../../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../pvc-globals/pvc-globals.html">

<link rel="import" href="speakur-author-img.html">

<polymer-element
    name="speakur-login-button"
    extends="speakur-base"
    attributes="user statusKnown width height">
    <template>
        <style>
            .username {
                color: dimgray;
                font-size: 0.9em;
                padding: 5px;
                text-align: center;
                display: inline;
            }

            .provider {
                font-size: 0.8em;
                padding: 5px;
                color: darkslategray;
                text-align: center;
                display: inline;
            }

            .icon {
                margin-right: 8px;
            }
        </style>
        <pvc-globals namespace="speakur-discussion" values="{{globals}}"></pvc-globals>

        <!-- duplicating the whole structure is the only way it seems to accommodate dynamic size changes due to login/logout status? -->
        <template if="{{ statusKnown && user }}">
            <paper-menu-button halign="right">
                <div class="toolbar-icon toolbar-icon-author">
                    <speakur-author-img
                        width="{{width}}" height="{{height}}"
                        author="{{globals.profile}}">
                    </speakur-author-img>
                </div>

                <paper-dropdown class="dropdown speakur-paper-dropdown" layered transition="">
                    <core-menu class="menu" excludedLocalNames="div">
                        <core-item>
                            <div class="username">{{globals.profile.username}}</div>
                            <div class="provider">{{ describeProvider(user.provider) }}</div>
                        </core-item>
                        <paper-item on-click="{{editProfile}}" title="Edit your profile">
                            <core-icon icon="settings" class="icon"></core-icon>
                            Edit Profile
                        </paper-item>
                        <paper-item on-click="{{logout}}" title="Sign out of Speakur">
                            <core-icon icon="social:person-outline" class="icon"></core-icon>
                            Sign Out
                        </paper-item>
                    </core-menu>
                </paper-dropdown>
            </paper-menu-button>

        </template>
        <template if="{{ !statusKnown || ! user }}">
            <paper-menu-button halign="right">
                <paper-icon-button icon="social:person" class="toolbar-icon toolbar-icon-anon">
                </paper-icon-button>

                <!--<paper-icon-button icon="social:person"></paper-icon-button>-->
                <paper-dropdown class="dropdown speakur-paper-dropdown" transition="" layered>
                    <core-menu class="menu">
                        <paper-item on-click="{{login}}" hidden?="{{!statusKnown || user}}">
                            <core-icon icon="social:person" class="icon toolbar-icon"></core-icon>
                            Sign In
                        </paper-item>
                    </core-menu>
                </paper-dropdown>
            </paper-menu-button>
        </template>

    </template>
    <script>
        Polymer({
            width: 24,
            height: 24,

            login: function () {
                this.fire('loginButtonPressed');
            },

            logout: function () {
                this.fire('logoutButtonPressed');
            },

            editProfile: function () {
                this.fire('editProfileButtonPressed');
            },

            describeProvider: function (provider) {
                if (!provider) {
                    return '';
                }
                if (provider === "facebook") {
                    return "(Facebook)";
                } else if (provider === "google") {
                    return "(Google)";
                } else {
                    return "";
                }
            }
        });
    </script>
</polymer-element>

