<!--
Copyright (c) 2015 Preston Landers. All rights reserved.
This code may only be used under the BSD style license found at http://speakur.github.io/LICENSE.txt
The complete set of authors may be found at http://speakur.github.io/AUTHORS.txt
The complete set of contributors may be found at http://speakur.github.io/CONTRIBUTORS.txt
-->
<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../core-menu/core-menu.html">
<link rel="import" href="../../paper-item/paper-item.html">
<link rel="import" href="../../paper-menu-button/paper-menu-button.html">
<link rel="import" href="../../paper-dropdown/paper-dropdown.html">
<link rel="import" href="../../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../pvc-globals/pvc-globals.html">

<polymer-element
    name="speakur-login-button"
    extends="speakur-base"
    attributes="user statusKnown">
    <template>
        <style>
            .username {
                color: dimgray;
                font-size: 0.9em;
                padding: 5px;
                text-align: center;
                display: inline;
            }
            .provider {
                font-size: 0.8em;
                padding: 5px;
                color: darkslategray;
                text-align: center;
                display: inline;
            }
        </style>
        <pvc-globals namespace="speakur-discussion" values="{{globals}}"></pvc-globals>

        <!-- duplicating the whole structure is the only way it seems to accommodate dynamic size changes due to login/logout status? -->
        <template if="{{ user }}">
            <paper-menu-button halign="right">
                <paper-icon-button icon="social:person"></paper-icon-button>
                <paper-dropdown class="dropdown" transition="">
                    <core-menu class="menu" excludedLocalNames="div">
                        <div class="username">{{globals.profile.username}}</div>
                        <div class="provider">{{ describeProvider(user.provider) }}</div>
                        <paper-item on-click="{{logout}}">Sign Out</paper-item>
                    </core-menu>
                </paper-dropdown>
            </paper-menu-button>
        </template>
        <template if="{{ ! user }}">
            <paper-menu-button halign="right">
                <paper-icon-button icon="social:person"></paper-icon-button>
                <paper-dropdown class="dropdown" transition="">
                    <core-menu class="menu">
                        <paper-item on-click="{{login}}" hidden?="{{!statusKnown || user}}">Sign In</paper-item>
                    </core-menu>
                </paper-dropdown>
            </paper-menu-button>
        </template>


    </template>
    <script>
        Polymer({
            login: function () {
                this.fire('loginButtonPressed');
            },

            logout: function () {
                this.fire('logoutButtonPressed');
            },

            describeProvider: function (provider) {
                if (!provider) {
                    return '';
                }
                if (provider === "facebook") {
                    return "(Facebook)";
                } else if (provider === "google") {
                    return "(Google)";
                } else {
                    return "";
                }
            }
        });
    </script>
</polymer-element>

