{
  "rules": {
    "admins": {
      // readable by the world
      ".read": true,
      // NOT writable by the world
      ".write": false,
      "$uid": {
        ".validate": "newData.hasChildren(['scope'])"
      }
    },
    "public_profile": {
      ".read": true,
      "$uid": {
        ".write": "!data.exists() && auth.uid === $uid"
      }
    },
    "profile": {
      ".read": false,
      "$uid": {
        ".read": "auth.uid === $uid",
        ".write": "!data.exists() && auth.uid === $uid"
      }
    },

    // Post records -- body of posts
    "posts": {
      ".read": true,
      ".write": true,
      "$parentId": {
        "$childId": {
          // must be admin or post owner to modify a post...
          ".write": "!data.exists() && ( auth.uid === newData.child('author').child('uid').val() || auth.id === root.child('admins').child(auth.id).child('scope').val() === '*' ) ",
          ".validate": "newData.hasChildren(['threadId', 'text', 'author']) && newData.child('timestamp').val() > 1",
          "$author": {
            ".validate": "newData.child('uid').val() != null"
          }
        }
      }
    },

    // Thread records
    "threads": {
      ".read": true,
      ".write": false,  // TODO: admin only?!
      "$threadId": {
        ".validate": "newData.hasChildren(['threadId', 'title', 'href', 'created']) && newData.child('timestamp').val() > 1 ",
        "$author": {
          ".validate": "newData.child('uid').val() != null"
        }

      }
    },

    // Public Vote counts for posts
    "postvotes": {

      // READ: ALL
      ".read": true,

      // WRITE: Authenticated
      ".write": "auth != null",

      // parentId -> childId -> { up, down, timestamp }
      "$parentId": {
        "$childId": {
          ".validate": "newData.hasChildren(['down', 'up', 'timestamp'])",
          "$timestamp": {
            ".validate": "newData.isNumber() && newData.val() > 1"
          }
        }
      }

    },

    // Private Vote tallies for each user
    "uservotes": {

      // READ/WRITE: false by default
      ".read": false,
      ".write": false,

      // Allow users to write under their own area
      "$uid": {
        ".read": "auth.uid === $uid",
        ".write": "!data.exists() && auth.uid === $uid",

        // Validate vote structure
        // uid -> parentId -> childId -> { up, down, timestamp }
        "$parentId": {
          "$childId": {
            ".validate": "newData.hasChildren(['down', 'up', 'timestamp'])",
            "$timestamp": {
              ".validate": "newData.isNumber() && newData.val() > 1"
            }
          }
        }
      }
    },


    // Don't let users post to other fields
    "$other": {".validate": false}
  }
}
